# Part 4 Project Group 58

## The reconstruction of speech/voice with the use of noise-cancelling algorithms and machine learning

Team members: Edward Chan and Timothy Aguana Cabrera

Abstract:

## Structure
The repository has the following structure
- [Creating-Dataset](Creating-Dataset): Contains a python program used to generate the dataset to train and test models
- [Dataset](Dataset): Where the training dataset is generated after using [Creating-Dataset](Creating-Dataset) and where evaluation wav files should be placed
- [Evaluation](Evaluation): Contains a python program used to perform speech enhancement and generate the evaluation of one or more audio wav files
- [Exhibition-Day-Presentation](Exhibition-Day-Presentation): Contains the exhibition presentation and poster
- [Models-Setup](Models-Setup): Contains python code for both training both the GAN and the CNN models
- [Models](Models): Where models generated by [Models-Setup](Models-Setup) is kept and loaded from
- [Others](Others): Stores progression documentation, presentation and flowcharts
- [Project-Compendium-Report](Project-Compendium-Report): Contains the report of the overall compendium
- [Results](Results): CNN classification results, GAN results and the overall system evaluation results
- [Seminar-Presentation](Seminar-Presentation): The presentation slides for the mid-year seminar

## Getting Started
1. Install Python version 3.8.0
2. Clone the repository
3. Run `pip install -r requirements.txt` in terminal (use correct cloned directory to install required packages)

## Packages
We used Python version 3.8.0 and we used pip version 23.2.1
The packages that we used:
| Package Name | Version |
| --- | --- |
| Torch | 2.0.1 |
| Torchaudio | 2.0.2 |
| Librosa | 0.10.1 |
| Scipy | 1.10.1 |
| Numpy | 1.23.4 |
| Pydub| 0.25.1 |
| Soundfile | 0.12.1 |
| Openpyxl | 3.1.2 |
| Xlsxwriter | 3.1.2|
| Matplotlib | 3.7.2 |
| Tensorflow | 2.8.0 |
| Keras | 2.8.0 |
| Scikit-learn | 1.3.0 |
| Seaborn | 0.12.2 |
| Pesq | 0.0.4 |
| Pystoi | 0.3.3 |
| Mir_eval | 0.7 |


## Setup

### Creating Dataset
- Go to [Creating-Dataset](Creating-Dataset)
- Open create-dataset.ipynb
- Download the [speech dataset](https://www.kaggle.com/datasets/showmik50/vctk-dataset) and [noise dataset](https://www.kaggle.com/datasets/chrisfilo/demand)
- Extract these folders place them in [Creating-Dataset](Creating-Dataset) (Create a new folder called "noisy" and extract the noisy dataset in the folder)
- In Step 5 change the number of samples to create to you desired value `n = 1500`
- Then Run All

### Generating CNN Classification Model
- Go to [Classification-Setup](Models-Setup/Classification-Setup)
- Open class_model.ipynb
- In Step 4 change the batch_size and epoch number to your desired value `batch_size=10, epochs=20`
- Change model name in Step 6 to your desired name `model.save(model_path + 'my_model.h5')`
- Run from Step 1 to Step 6 to save model (Step 7 loads the model and predicts the SNR levels for all wav files in `path_test_dataset = "../../Dataset/predict_dataset/"`)

### Generating GAN Speech Enhancement Model
- Go to [GAN-Setup](Models-Setup/GAN-Setup)
- After the steps outlines in Creating Dataset, run the Silero-VAD file to apply VAD SNR. This will generate a new audio files in Database/VAD_SNR
- To prepare the data for the WGAN go to [GAN-Setup](Models-Setup/GAN-Setup) and run both Generate_Noise_PSDs and Generate_Speech_PSDs
- After data creation, run the Noise-WGAN-GP-model and Noise-WGAN-GP-models.

### Perform Evaluation
- Go to [Evaluation](Evaluation)
- Open performing_evaluation.ipynb
- If need be change directory for CNN model in Step 1 `cnn_model = tf.keras.models.load_model('../Models/Classification Models/my_model.h5')`
- If need be change directory for GAN model in Step 1 `Noise_gan = tf.saved_model.load('../Models/GAN Models/Full_Curriculum_4_generator')`
- You can also change the directory for where the evaluation is saved in Step 3 `path_eval = "Evaluation1"`
- Run Step 1 to 3 to create a directory for where the evaluation will be performed
- With the directory created add your desired noisy mixture and clean speech to folders in `path_eval = "Evaluation1"` named `clean_path = path_eval + "/clean"` and `noisy_path = path_eval + "/noisy"`
- Make sure the name of the audio added is speech_"number".wav the same as the create_dataset convention (With the text inside "" being changed to a number)
- Run Step 4

## Future Improvements

## Key Notes
- We created this program using Windows 10

## Acknowledgement
We want to thank the supervisor, Catherine Watson, and co-supervisor, Yusuke Hioka, for providing the support and guidelines to make this project successful.
